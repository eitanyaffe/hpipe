if [[ $# -eq 0 ]] ; then
    echo 'usage <hpipe_dir> <config_dir>'
    exit 0
fi
HPIPE_DIR=$1
CFG_DIR=$2

LINK_FILE=$(CFG_DIR)/docker_links
CFG_ID=`$(CFG_DIR)/id`

IMAGE_NAME=hpipe_base
D_RUN_OPTS="-it"
PERMISSIONS_PATHS="-v /etc/passwd:/etc/passwd -v /etc/shadow:/etc/shadow -v /etc/group:/etc/group"
CONTAINER_NAME=${USER}_${IMAGE_NAME}

IO_PATHS="-v $CONFIG_DIR:/hpipe/config -v $OUTDIR:/hpipe/output -v $TMPDIR:/hpipe/tmp"
. $PATHS_FILE

MAKE_OPTS="-n"

echo "container: ${CONTAINER_NAME}"
if docker ps -a -f name=${CONTAINER_NAME} | grep -q ${CONTAINER_NAME}
then
    echo "removing container: ${CONTAINER_NAME}"
    # docker rm -f ${CONTAINER_NAME}
fi
# CMD="docker run ${D_RUN_OPTS} --rm -u ${USER} ${PERMISSIONS_PATHS} ${IO_PATHS} --name ${CONTAINER_NAME} ${IMAGE_NAME} make $TARGET $MAKE_OPTS"
CMD="docker run ${D_RUN_OPTS} --rm -u ${USER} ${PERMISSIONS_PATHS} ${IO_PATHS} --name ${CONTAINER_NAME} ${IMAGE_NAME} bash"
echo ${CMD}
${CMD}
